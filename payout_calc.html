<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Payout Calculator</title>
</head>
<body>
    <div class="inputs">
        <h1>ðŸŽ° Poker Payout Calculator</h1>
        
        <div class="form-group">
            <label for="entry-cost">Entry Cost:</label>
            <input type="number" id="entry-cost" name="entry-cost" placeholder="e.g., 100">
        </div>
        
        <div class="form-group">
            <label for="total-prize-pool">Total Prize Pool:</label>
            <input type="number" id="total-prize-pool" name="total-prize-pool" placeholder="e.g., 10000">
        </div>
        
        <div class="form-group">
            <label for="payout-percentage">Payout Percentage:</label>
            <select id="payout-percentage" name="payout-percentage">
                <option value="10">10%</option>
                <option value="12.5">12.5%</option>
                <option value="15" selected>15%</option>
                <option value="17.5">17.5%</option>
                <option value="20">20%</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="steepness">Steepness (1-100):</label>
            <input type="number" min="1" max="100" id="steepness" name="steepness" placeholder="e.g., 50">
        </div>
        
        <div class="form-group">
            <label for="round-to">Round to nearest:</label>
            <input type="number" id="round-to" name="round-to" placeholder="e.g., 5">
        </div>
        
        <div class="form-group">
            <label for="min-cash">Min-Cash:</label>
            <input type="number" id="min-cash" name="min-cash" placeholder="e.g., 50">
        </div>
        
        <div class="checkbox-group">
            <label for="group-payouts">
                <input type="checkbox" id="group-payouts" name="group-payouts">
                Group lower payouts (average nearby values)
            </label>
        </div>
        
        <div class="form-group indent">
            <label for="group-threshold">Group from position:</label>
            <input type="number" id="group-threshold" name="group-threshold" value="10" min="1">
        </div>
        
        <button onclick="calc_payouts();">Calculate Payouts</button>
        
        <div class="info-display">
            <div class="info-item">
                <div class="info-label">Total Entries</div>
                <div class="info-value" id="total-entries">-</div>
            </div>
            <div class="info-item">
                <div class="info-label">Places Paid</div>
                <div class="info-value" id="places-paid-display">-</div>
            </div>
        </div>
        
        <div class="results-section">
            <div class="section-title">Payouts</div>
            <ul id="payouts"></ul>
            <button class="copy-button" onclick="copyList()">ðŸ“‹ Copy Payouts</button>
        </div>
        
        <div class="variance-container">
            <div class="variance-label">Variance</div>
            <div id="variance">-</div>
        </div>
    </div>
    <script>
        function calc_payouts(){
            let entry_cost = parseFloat(document.getElementById("entry-cost").value);
            let total_prize_pool = parseFloat(document.getElementById("total-prize-pool").value);
            let payout_percentage = parseFloat(document.getElementById("payout-percentage").value);
            let steepness = parseFloat(document.getElementById("steepness").value);
            let round_to = parseFloat(document.getElementById("round-to").value);
            let min_cash = parseFloat(document.getElementById("min-cash").value);
            let group_payouts = document.getElementById("group-payouts").checked;
            let group_threshold = parseInt(document.getElementById("group-threshold").value);
            
            // Calculate total entries and places paid
            let total_entries = Math.round(total_prize_pool / entry_cost);
            let places_paid = Math.round(total_entries * (payout_percentage / 100));
            
            // Display calculated values
            document.getElementById("total-entries").innerText = total_entries;
            document.getElementById("places-paid-display").innerText = places_paid;
            
            let reserved_min_prizepool = min_cash * places_paid;
            let ladder_prize_pool = total_prize_pool - reserved_min_prizepool;
            let actual_steepness = (100-steepness)/100;
            let normalise = 0;
            let payout_decays = [];
            let normalised_decays = [];
            let realised_payouts = [];
            
            for (let i = 0; i < places_paid; i++) {
                let decay = Math.pow(actual_steepness, i + 1);
                payout_decays.push(decay);
                normalise += decay;
            }
            
            //sum of all the decays should equal 1
            //sum of all decay * prizepool will equal prizepool
            //no more, no less
            for (let i = 0; i < payout_decays.length; i++) {
                normalised_decays.push(payout_decays[i] / normalise);
            }
            
            for (let i = 0; i < normalised_decays.length; i++) {
                let payout = normalised_decays[i] * ladder_prize_pool;
                let roundedPayout = (round_to * Math.round((payout + min_cash) / round_to));
                realised_payouts.push(roundedPayout);
            }
            
            // Apply grouping if enabled
            if (group_payouts && group_threshold > 0 && group_threshold <= places_paid) {
                // Group payouts from the threshold position onwards in groups of 3
                for (let i = group_threshold - 1; i < realised_payouts.length; i += 3) {
                    let group_end = Math.min(i + 3, realised_payouts.length);
                    let group_size = group_end - i;
                    
                    // Calculate average of the group
                    let group_sum = 0;
                    for (let j = i; j < group_end; j++) {
                        group_sum += realised_payouts[j];
                    }
                    let group_average = group_sum / group_size;
                    let rounded_average = round_to * Math.round(group_average / round_to);
                    
                    // Set all values in group to the average
                    for (let j = i; j < group_end; j++) {
                        realised_payouts[j] = rounded_average;
                    }
                }
            }
            
            //display payouts
            let payouts = document.getElementById("payouts");
            payouts.innerHTML = "";
            for (let i = 0; i < realised_payouts.length; i++) {
                let listItem = document.createElement("li");
                listItem.innerText = `${i+1}: ${realised_payouts[i]}`;
                payouts.appendChild(listItem);
            }
            
            // Fixed variance calculation - the sum minus the pool gives correct sign
            let variance = total_prize_pool - parseFloat((realised_payouts.reduce((a,b)=> a+b, 0)));
            console.log(variance);
            
            if (variance > 0){
                document.getElementById("variance").style.color = "red";
            }
            else if (variance < 0){
                document.getElementById("variance").style.color = "green";
            }
            else{
                document.getElementById("variance").style.color = "black";
            }
            document.getElementById("variance").innerText = variance;
        }
        
        function copyList() {
            let listItems = document.querySelectorAll("#payouts li");
            let combinedText = "";
            listItems.forEach(item => {
                combinedText += item.innerText + "\n";
            });
            
            navigator.clipboard.writeText(combinedText)
                .then(() => alert("Copied to clipboard!"))
                .catch(err => console.error("Failed to copy:", err));
        }
    </script>
</body>
<style>
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .inputs {
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
    }
    
    h1 {
        color: #333;
        margin-bottom: 30px;
        text-align: center;
        font-size: 28px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-weight: 500;
        font-size: 14px;
    }
    
    input[type="number"], select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    input[type="number"]:focus, select:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        margin-right: 8px;
    }
    
    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .checkbox-group label {
        margin-bottom: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
    }
    
    .indent {
        margin-left: 26px;
    }
    
    button {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-top: 10px;
    }
    
    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    .copy-button {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        margin-top: 15px;
    }
    
    .copy-button:hover {
        box-shadow: 0 8px 20px rgba(17, 153, 142, 0.4);
    }
    
    .info-display {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        display: flex;
        justify-content: space-around;
        border: 2px solid #e0e0e0;
    }
    
    .info-item {
        text-align: center;
    }
    
    .info-label {
        font-size: 12px;
        color: #777;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
    }
    
    .info-value {
        font-size: 24px;
        font-weight: 700;
        color: #667eea;
    }
    
    .results-section {
        margin-top: 30px;
    }
    
    .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
    }
    
    #payouts {
        list-style-type: none;
        max-height: 400px;
        overflow-y: auto;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }
    
    #payouts li {
        padding: 10px 15px;
        margin-bottom: 8px;
        background: white;
        border-radius: 6px;
        border-left: 4px solid #667eea;
        font-family: 'Courier New', monospace;
        transition: transform 0.2s ease;
    }
    
    #payouts li:hover {
        transform: translateX(5px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .variance-container {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-top: 15px;
    }
    
    .variance-label {
        font-size: 12px;
        color: #777;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
    }
    
    #variance {
        font-size: 28px;
        font-weight: 700;
        font-family: 'Courier New', monospace;
    }
    
    /* Scrollbar styling */
    #payouts::-webkit-scrollbar {
        width: 8px;
    }
    
    #payouts::-webkit-scrollbar-track {
        background: #e0e0e0;
        border-radius: 4px;
    }
    
    #payouts::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 4px;
    }
    
    #payouts::-webkit-scrollbar-thumb:hover {
        background: #764ba2;
    }
    
    @media (max-width: 600px) {
        .inputs {
            padding: 25px;
        }
        
        h1 {
            font-size: 24px;
        }
        
        .info-display {
            flex-direction: column;
            gap: 15px;
        }
    }
</style>
</html>
